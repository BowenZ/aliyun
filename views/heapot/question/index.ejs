<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="zh-CN" class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>答题</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale = 1.0,maximum-scale = 1.0, user-scalable=no">
    <link rel="stylesheet" href="css/main.css">
</head>

<body>
    <!--[if lt IE 9]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
    <!-- Add your site or application content here -->
    <div class="wrapper">
        <section class="main">
            <header>
                <h1>答题</h1>
            </header>
            <div class="container">
                <form action="">
                    <ol class="questions">
                        <% questions.forEach(function(question, index){ %>
                        <li class="question">
                            <h4><%= question.title %></h4>
                            <ol class="options">
                                <% question.options.forEach(function(opt, idx){ %>
                                <li class="<%= opt.checked %>">
                                    <div class="<%= question.type %>">
                                        <label>
                                            <input type="<%= question.type %>" name="<%= question._id %>" data-checked="<%= opt.checked %>"><%= opt.option %>
                                        </label>
                                    </div>
                                </li>
                                <% }) %>
                            </ol>
                            <p class="explain"><strong>解释：</strong><%= question.explain %></p>
                        </li>
                        <% }) %>
                    </ol>
                    <button type="button" class="btn btn-success btn-block submit">提交</button>
                </form>
            </div>
        </section>
        <div class="layer">
            <div class="result">
                <p>您一共答对了<strong>6</strong>道题</p>
                <p>很遗憾没有中奖，下次再接再厉</p>
                <div class="row">
                    <div class="col-xs-6">
                        <button class="btn btn-success btn-block">再来一次</button>
                    </div>
                    <div class="col-xs-6">
                        <button class="btn btn-warning btn-block">查看问题解释</button>
                    </div>
                </div>
            </div>
        </div>
        <button class="btn btn-danger btn-lg side-btn">去领奖</button>
    </div>
    <script src="http://libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
    <!--<script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>-->
    <script>
    window.jQuery || document.write('<script src="js/vendor/jquery.min.js"><\/script>')
    </script>
    <script src="js/plugins.js"></script>
    <script src="js/main.js"></script>
    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
    <!--<script>
            var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>-->
    <script>
$(document).ready(function() {
    setTimeout(function() {window.scrollTo(0,0);}, 200);
    var REDIRECT_URL = 'https://www.baidu.com/',
        submited = false;
    var $form = $('form'),
        $layer = $('.layer'),
        $sideBtn = $('.side-btn');
    $('.submit').click(function(event) {
        if(submited){
            alert('不能重复提交');
            return;
        }
        if(window.confirm('确定要提交吗？')){
            submited = true;
            $('.submit').attr('disabled', 'disabled');
            // $('input').attr('disabled', 'disabled');
            var answers = [], wrongNum = 0, wrongFlag = false;
            $('form .question').each(function(index, item) {
                $(item).find('input').each(function(i, el) {
                    if($(el).is(':checked') != $(el).data('checked')){
                        $(item).addClass('wrong');
                        wrongFlag = true;
                    }
                });
                if(wrongFlag){
                    wrongNum++;
                    wrongFlag = false;
                }
            });
            $('form').addClass('done');
            
            console.log('一共错了'+wrongNum+'道题');
            $layer.find('p:eq(0) strong').text(10 - wrongNum);
            if(wrongNum > 1){
                $layer.find('p:eq(1)').text('很遗憾没有中奖，下次再接再厉');
                $layer.find('button:eq(0)').text('再来一次').data('prize', '0');
            }else{
                $layer.find('p:eq(1)').text('恭喜您中奖啦，点击下方按钮去领奖吧')
                $layer.find('button:eq(0)').text('马上领奖').data('prize', '1');
            }
            $layer.fadeIn(200);
        }
    });

    $layer.find('button:eq(0)').click(function() {
        if($(this).data('prize') == 0){
            location.reload();
        }else{
            window.location.href = REDIRECT_URL;
        }
    });

    $layer.find('button:eq(1)').click(function() {
        $sideBtn.text($layer.find('button:eq(0)').data('prize') == 0? '再来一次':'去领奖').fadeIn(200);;
        $layer.fadeOut(200);
        window.scrollTo(0,0);
    });

    $sideBtn.click(function() {
        if($layer.find('button:eq(0)').data('prize') == 0){
            location.reload();
        }else{
            window.location.href = REDIRECT_URL;
        }
    });
});
    </script>
</body>

</html>
